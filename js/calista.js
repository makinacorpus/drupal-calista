!function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=(n.n(r),n(2));n.n(i)},function(t,e){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(4);n(5),Drupal.behaviors.calistaPage={attach:function(t,e){for(var n=0,r=t.querySelectorAll("[data-page]:not([data-page-initialized])");n<r.length;n++){var a=r[n];new i.Page(a)}}},Drupal.behaviors.calistaPane={attach:function(t,e){for(var n=0,i=t.querySelectorAll("#contextual-pane");n<i.length;n++){var a=i[n];new r.Pane(a)}}}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,a){function o(t){try{l(r.next(t))}catch(t){a(t)}}function s(t){try{l(r.throw(t))}catch(t){a(t)}}function l(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(o,s)}l((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,a&&(o=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(a,n[1])).done)return o;switch(a=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,a=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=e.call(t,l)}catch(t){n=[6,t],a=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,a,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var a=function(){return function(t,e,n){this.element=t,this.linkElement=e,this.name=n}}(),o=function(){function t(){}return t.prototype.isHidden=function(){return new RegExp("calista-pane-hidden=1").test(document.cookie)},t.prototype.hide=function(){document.cookie="calista-pane-hidden=1"},t.prototype.show=function(){document.cookie="calista-pane-hidden=0"},t}(),s=function(){function t(t){var e=this;this.displayed=!0,this.element=t,this.state=new o;var n=t.querySelector("#contextual-pane-toggle a");n.addEventListener("click",function(t){t.stopPropagation(),t.preventDefault(),e.togglePane(),n.blur()}),this.restoreInitialState(),this.refresh();var r=t.getAttribute("data-active-tab")||"";r&&this.toggleTab(r)}return t.prototype.restoreInitialState=function(){return r(this,void 0,void 0,function(){var t=this;return i(this,function(e){return this.element.classList.add("initial-collapse"),setTimeout(function(){t.element.classList.remove("initial-collapse")},1e3),this.state.isHidden()?(this.displayed=!1,this.element.classList.add("contextual-collapsed")):(this.displayed=!0,this.element.classList.remove("contextual-collapsed")),[2]})})},t.prototype.refresh=function(){return r(this,void 0,void 0,function(){var t,e,n,r,o,s=this;return i(this,function(i){for(this.tabs=[],t=function(t){var n=t.getAttribute("data-tab-toggle")||"",r=e.element.querySelector("[data-tab="+n+"]");if(!r)return t.setAttribute("disabled","disabled"),t.classList.add("disabled"),t.classList.remove("active"),"continue";e.tabs.push(new a(r,t,n)),t.addEventListener("click",function(t){t.stopPropagation(),t.preventDefault(),s.toggleTab(n)})},e=this,n=0,r=this.element.querySelectorAll("[data-tab-toggle]");n<r.length;n++)o=r[n],t(o);return[2]})})},t.prototype.togglePane=function(){return r(this,void 0,void 0,function(){return i(this,function(t){return this.displayed?(this.element.classList.add("contextual-collapsed"),this.displayed=!1,this.state.hide()):(this.element.classList.remove("contextual-collapsed"),this.displayed=!0,this.state.show()),[2]})})},t.prototype.toggleTab=function(t){return r(this,void 0,void 0,function(){var e,n,r,a;return i(this,function(i){for(console.log("contextual pane: toggled tab: "+t),e=null,n=0,r=this.tabs;n<r.length;n++)(a=r[n]).name===t?e=a:(a.element.classList.remove("active"),a.linkElement.classList.remove("active"));return e?(e.element.classList.add("active"),e.linkElement.classList.add("active")):console.log("contextual pane: could not find tab: "+t),[2]})})},t}();e.Pane=s},function(t,e,n){"use strict";function r(t){if(""===t)return{};var e=t.indexOf("?");if(-1===e)return{};var n={};return(t=t.substr(e+1)).split("&").forEach(function(t){var e=t.indexOf("=");if(-1===e)n[t]="";else{var r=t.substr(0,e),i=t.substr(e+1);n[r]=decodeURIComponent(i.replace(/\+/g," "))}}),n}function i(t){var e=[];for(var n in t)e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e.join("&")}function a(t,e,n){void 0===n&&(n=!1);var r;return function(){var i=this,a=arguments,o=n&&!r;clearTimeout(r),r=setTimeout(function(){r=null,n||t.apply(i,a)},e),o&&t.apply(i,a)}}var o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,a){function o(t){try{l(r.next(t))}catch(t){a(t)}}function s(t){try{l(r.throw(t))}catch(t){a(t)}}function l(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(o,s)}l((r=r.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,a&&(o=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(a,n[1])).done)return o;switch(a=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,a=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=e.call(t,l)}catch(t){n=[6,t],a=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,a,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t){if(this.ajaxOnly=!1,this.baseUrl="/",this.refreshing=!1,this.element=t,this.element.setAttribute("data-page-initialized","1"),t.hasAttribute("data-page-query")){var e=t.getAttribute("data-page-query");try{this.query=JSON.parse(e)}catch(t){console.log("invalid JSON: "+e),this.query={}}}this.route=t.getAttribute("data-page-route"),this.id=t.getAttribute("data-page"),this.viewType=t.getAttribute("data-view-type"),this.searchParam=t.getAttribute("data-page-search"),this.ajaxOnly=t.hasAttribute("data-ajax-only"),this.modal=document.createElement("div"),this.modal.setAttribute("class","page-modal"),this.element.insertBefore(this.modal,this.element.firstChild),this.attachBehaviors()}return t.prototype.request=function(t,e){var n=this;return new Promise(function(r,a){var o=new XMLHttpRequest;o.open("GET",n.baseUrl+t+"?"+i(e)),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.addEventListener("load",function(){200!==this.status?a(this.status+": "+this.statusText):r(o)}),o.addEventListener("error",function(){a(this.status+": "+this.statusText)}),o.send()})},t.prototype.placePageBlocks=function(t){if(t.query&&(this.query=t.query),t.blocks)for(var e in t.blocks){for(var n=0,r=0,i=this.element.querySelectorAll("[data-page-block="+e+"]");r<i.length;r++)i[r].innerHTML=t.blocks[e],n++;n?(1<n&&console.log("Warning, block "+e+" exists more than once in page"),this.attachBehaviors()):console.log("Warning, block "+e+" does not exists in page")}},t.prototype.reload=function(t,e){e&&console.log(e),window.location.href=t},t.prototype.modalSpawn=function(){this.modal.classList.add("loading")},t.prototype.modalDestroy=function(){this.modal.classList.remove("loading")},t.prototype.refreshPage=function(t,e){return void 0===e&&(e=!1),o(this,void 0,void 0,function(){var n,r,a,o=this;return s(this,function(s){if(this.refreshing)return[2];if(this.refreshing=!0,n=location.pathname+"?"+i(t),"twig_form_page"===this.viewType)return this.reload(n),[2];if(this.modalSpawn(),r={},r._page_id=this.id,r._route=this.route,!e)for(a in this.query)r[a]=this.query[a];if(t)for(a in t)r[a]=t[a];return this.request("admin/calista/refresh",r).then(function(t){var e=JSON.parse(t.responseText);if(!e)throw t.status+": "+t.statusText+": got invalid response data";o.placePageBlocks(e),o.refreshing=!1,o.modalDestroy()},function(t){o.reload(n,t)}).catch(function(t){o.reload(n,t)}),[2]})})},t.prototype.attachBehaviors=function(){var t=this,e=this;Drupal.attachBehaviors(this.element);for(var n=0,i=this.element.querySelectorAll("[data-page-link]");n<i.length;n++)!function(t){t.addEventListener("click",function(n){n.stopPropagation(),n.preventDefault(),e.refreshPage(r(t.getAttribute("href")||""),!0)})}(i[n]);var o=this.element.querySelector("form.calista-search-form");if(o){var s=o.querySelector("input[type=text]");if(s){var l=a(function(e){var n={};n[t.searchParam||"s"]=s.value,t.refreshPage(n)},500);s.addEventListener("keydown",l),s.addEventListener("keypress",l),s.addEventListener("change",l)}o.addEventListener("submit",function(e){if(e.stopPropagation(),e.preventDefault(),s){var n={};n[t.searchParam||"s"]=s.value,t.refreshPage(n)}})}var u=this.element.querySelector('[data-page-checkbox="all"]');if(u){var c=this.element.querySelectorAll("table input:checkbox");c.length&&u.addEventListener("click",function(t){t.stopPropagation();for(var e=0,n=c;e<n.length;e++)n[e].checked=u.checked})}},t}();e.Page=l},function(t,e,n){"use strict"}]);